<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.7.0/jquery.lettering.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/textillate/0.4.0/jquery.textillate.min.js"></script>
    <script src="./rainyday.min.js"></script>
    <script src="../ignore/script.js"></script>
  </head>
  <style>
    *{
    margin:0;
    padding:0;
    box-sizing:border-box;
    }
     body {
                /* overflow: hidden; */
                height: 100%;
                margin: 0;
                padding: 0;
            }
    img {
      object-fit: cover;
      width: 98vw;
      height: 98vh;
      object-position: center;
    }
    #loctTitle {
      mix-blend-mode: difference;
      color: black;
      font-size: min(8vw, max(100px, 8vw));
      mix-blend-mode: difference;
      /* text-align: end; */
      font-family: "Russo One", sans-serif;
      font-weight: 400;
      font-style: normal;
      text-shadow: 1px 1px 0px #fff, 2px 2px 0px #000, 3px 3px 0px #fff,
        4px 4px 0 #000, 5px 5px 0 #fff, 6px 6px 0 #000, 7px 7px 0 #fff,
        8px 8px 0 #000;
    }
    #weatherIcon img {
      width: 100px;
      height: 100px;
    }
    #condition {
      background: rgba(0 0 0 0.8);
      color: #fff;
      backdrop-filter: blur(50px);
      min-width: 300px;
      height: 300px;
      top: 50px;
      right: 50px;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 1px 1px 0px #fff, 2px 2px 0px #000, 3px 3px 0px #fff,
        4px 4px 0 #000, 5px 5px 0 #fff, 6px 6px 0 #000, 7px 7px 0 #fff,
        8px 8px 0 #000, 9px 9px 0 #fff, 10px 10px 0 #000, 11px 11px 0 #fff,
        12px 12px 0 #000, 13px 13px 0 #fff, 14px 14px 0 #000, 15px 15px 0 #fff,
        0 0 200px #fff;
    }
    #weather {
      font-weight: bolder;
      mix-blend-mode: difference;
      text-transform: uppercase;
    }
    #search {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .loct {
      text-transform: uppercase;
    }
    #mask{
      position:absolute;
      top:0;
      left:0;
    width:100vw;
    height:100vh;
    pointer-events:none;
    opacity:0.3;
    }
  </style>
  <body>
    <div class="container-fluid p-2 text-center">
      <img src="" alt="" id="mask">
      <img src="" alt="" id="background">
    </div>
    <div id="condition" class="position-absolute col-10 col-sm-3">
      <div class="row">
        <div>
          <!-- <div class="loct" id="loct"></div> -->
          <div id="weatherIcon"></div>
          <h3 id="weather"></h3>
          <h5 id="temp"></h5>
        </div>
      </div>
    </div>
    <div id="search" class="container">
      <div class="row">
        <div class="col m-5">
          <h1 class="textillate loct" id="loctTitle"></h1>
        </div>
      </div>
      <div class="row">
        <div class="col-5 offset-2">
          <input
            class="form-control bg-light"
            type="text"
            name=""
            id="location"
            placeholder="Anywhere you want"
          />
        </div>
        <div class="col-5">
          <button class="btn btn-dark" id="myBtn">how is weather?</button>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let myBtn = $("#myBtn");
      let loct = $(".loct");
      let weather = $("#weather");
      let temp = $("#temp");
      let weatherIcon = $("#weatherIcon");
      let image = $('#background')
      let mask = $('#mask')
      // $("#loctTitle").textillate();
      function rain(){
        mask.onload = function(){
            var rainyDay = new RainyDay({
            mask:this,
            })
            RainDay.rain([
        [5,2,2]
        ],0)
        }
        mask.attr("src","./bg.jpg");
        }
      function inTextillate(){
        $("#loctTitle").textillate({
              loop:false,
              in: {
    effect: 'fadeInLeftBig',
    delayScale: 1.5,
    delay: 200,
  }
            });
      }
      function unsplash(location) {
          $.ajax({
          type: "get",
          url: unsplashUrl,
          data: {
            // query:location+'+night',
            query: location,
            // color:'white',
            width: 1024,
            height: 768,
          },
          success: function (data) {
            let container = $(".container-fluid");
            let num = data.results.length;
            let key = Math.floor(Math.random() * num);
            console.log(data.results[key].urls.regular);
            // let img = $("<img>");
            image.attr("src", data.results[key].urls.regular);
            rain();
          },
        });
        $.ajax({
          type: "get",
          url: openweatherUrl,
          data: {
            q: location,
          },
          success: (data) => {
            console.log(data);
            let NowWeather = data.weather[0].description;
            let icon = data.weather[0].icon;
            let NowTemp = (Number(data.main.temp) - 273.15).toFixed(1);
            loct.html(data.name);
            weather.html(`${NowWeather}`);
            temp.html(`Celsius: ${NowTemp} deg`);
            let img = $("<img>");
            img.attr(
            "src",
            "https://openweathermap.org/img/wn/" + icon + "@2x.png"
            );
            weatherIcon.html(img);       
          },
          complete:function(){
              inTextillate(); 
              $('#loctTitle').textillate('destroy');
              // rain(data.results[key].urls.regular)  
              console.log(image.src);         
      
          }
        });
      }
      myBtn.on("click", function () {
        let selectLoc = $("#location").val();
        unsplash(selectLoc);
      });
      unsplash("japan");
    </script>
  </body>
</html>
