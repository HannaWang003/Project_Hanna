<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CB coffe Order</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="./img/battle-net.svg" type="image/x-icon" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Josefin+Sans&family=Kanit&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <style>
    body {
      font-family: "Kanit", sans-serif;
      font-weight: 400;
      background-color: #EFEBEA;
      background-image: url("./img/bg3.png"), url("./img/bg.png");
      background-size: contain, contain;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-position: left bottom, right top;
    }
    table {
      width: 100%;
      margin:auto;
    }
    table,
    tr,
    th,
    td {
      border-bottom: 1px solid #333;
      text-align: center;
    }
    td {
      backdrop-filter: blur(50px);
    }
    th {
      background: #e6d0ba;
    }
    th,
    td {
      padding: 10px;
    }
    img {
      width: 100px;
      height: 100px;
    }
    img {
      box-shadow: 0 0 5px #947055;
    }
    #promation {
      position: relative;
      width: 100vw;
      height: 100vh;
      z-index: 99;
    }
    #promation::before {
      content: "";
      position: fixed;
      width: 100%;
      height: 100%;
      background: #b3a18f83;
      backdrop-filter: blur(30px);
      z-index: 98;
    }
    .mask {
      background: #000000;
      position: fixed;
      height: 30vh;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-15deg);
      border: 1px solid rgb(0, 0, 0);
      z-index: 100;
      font-size: 3vw;
      text-align: center;
      box-shadow: 5px 5px 2px #635244;
      b {
        color: #e2721b;
        font-family: "Kanit", sans-serif;
        font-weight: 900;
        font-style: normal;
      }
    }
    .close {
      position: fixed;
      top: 5%;
      right: 5%;
      cursor: pointer;
      z-index: 101;
    }
    button{
      font-size:calc(0.75em+1vw);
    }
  </style>
  <body>
    <div id="promation">
      <div class="close text-end"><i class="fa-solid fa-x fa-2xl"></i></div>
      <div class="mask p-5">
        <p class="text-light">tOdAy's Special Offer !!</p>
        <b id="spDis">5% off over NT 500</b>
      </div>
    </div>
    <div class="container">
      <button
        data-item="coffe"
        class="itemBtn mt-2 mb-1 btn"
        style="background: #947055; color: #f4d4b3"
      >
        <i class="fa-solid fa-mug-saucer fa-lg"></i>
        Coffe
      </button>
      <button
        data-item="bread"
        class="itemBtn mt-2 mb-1 btn"
        style="background: #e6d0ba; color: #947055"
      >
        <i class="fa-solid fa-bread-slice fa-lg"></i>
        Bread
      </button>
      <div
        class="endBtn row mt-1 border rounded-5 p-3"
        id="coffe"
        style="margin:auto;width:100%;display: none; background: #947055"
      >
        <div class="col-3 text-center p-1">
          <button
            id="Latte"
            class="orbtn btn btn-outline-light w-75 text-dark"
            data-img="Latte.jpg"
            data-name="Latte"
            data-price="180"
            data-item="coffeitem"
          >
            Latte
          </button>
        </div>
        <div class="col-3 text-center p-1">
          <button
            id="Cappuccino"
            class="orbtn btn btn-outline-light w-75 text-dark"
            data-img="Cappuccino.jpg"
            data-name="Cappuccino"
            data-price="200"
            data-item="coffeitem"
          >
            Cappuccino
          </button>
        </div>
        <div class="col-3 text-center p-1">
          <button
            id="Mocha"
            class="orbtn btn btn-outline-light w-75 text-dark"
            data-img="mocha.jpg"
            data-name="Mocha"
            data-price="160"
            data-item="coffeitem"
          >
            Mocha
          </button>
        </div>
        <div class="col-3 text-center p-1">
          <button
            id="Espresso"
            class="orbtn btn btn-outline-light w-75 text-dark"
            data-img="essp.jpg"
            data-name="Espresso"
            data-price="240"
            data-item="coffeitem"
          >
            Espresso
          </button>
        </div>
      </div>
      <!-- bread -->
      <div
        class="endBtn row mt-1 border rounded-5 p-3"
        id="bread"
        style="margin:auto;width:100%;display: none; background: #e6d0ba"
      >
        <div class="col-3 text-center p-1">
          <button
            id="Croissant"
            class="orbtn btn btn-outline-light w-75 text-dark"
            data-img="Croissant.jpg"
            data-name="Croissant"
            data-price="50"
            data-item="breaditem"
          >
            Croissant
          </button>
        </div>
        <div class="col-3 text-center p-1">
          <button
            id="Baguette"
            class="orbtn btn btn-outline-light w-75 text-dark"
            data-img="Baguette.jpg"
            data-name="Baguette"
            data-price="120"
            data-item="breaditem"
          >
            Baguette
          </button>
        </div>
        <div class="col-3 text-center p-1">
          <button
            id="Scone"
            class="orbtn btn btn-outline-light w-75 text-dark"
            data-img="Scone.jpg"
            data-name="Scone"
            data-price="30"
            data-item="breaditem"
          >
            Scone
          </button>
        </div>
        <div class="col-3 text-center p-1">
          <button
            id="Cinnamon-Roll"
            class="orbtn btn btn-outline-light w-75 text-dark"
            data-img="Cinnamon-Roll.jpg"
            data-name="Cinnamon-Roll"
            data-price="30"
            data-item="breaditem"
          >
            Cinnamon-Roll
          </button>
        </div>
      </div>
      <!-- /bread -->
      <div class="row mt-3">
        <div class="col">
          <div class="fs-1 fw-bolder text-center">
            <span style="writing-mode:vertical-lr"> =) </span> CB coffe
          </div>
          <table>
            <tr id="orderHeader">
              <th>item</th>
              <!-- <th>price</th>
              <th>Q'ty</th>
              <th>Subtotal</th> -->
              <th>Price/Qty</th>
              <th class="text-light">Note/Operate</th>
            </tr>
            <tr class="bg-dark text-light">
              <td>TOTAL</td>
              <td>
                <p class="">discount</p>
                <p class="fw-bolder">
                  <b class="text-danger">5%</b> off for purchases over 500</b>
                </p>
              </td>
              <td rowspan="2" style="width: 30%">
                <div id="calulate" class="btn btn-light w-75 text-center" />
                  <i class="fa-solid fa-cart-arrow-down fa-2xl"></i
                  ><br />SHOPPING<br>CART
                </div>
              </td>
            </tr>
            <tr class="bg-dark text-light">
              <td id="orderTotal" class="fs-5 text-warning fw-bolder">0</td>
              <td id="dis" class="text-danger fw-bolder">0</td>
              <!-- <td></td> -->
            </tr>
          </table>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col text-end">
          <button id="ordernow" class="btn btn-dark">ORDER NOW</button>
        </div>
      </div>
    </div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      //啟用jquery
      $("document").ready(function () {
        //促銷訊息
        InOut("#spDis");
        //點餐
        function order() {
          // $(".orbtn").removeClass("btn-light");
          $(this).removeClass("btn-outline-light");
          $(this).addClass("btn-light");
          let itemqty = $(this).data("item");
          let img = $(this).data("img");
          let name = $(this).data("name");
          let price = $(this).data("price");
          let html = `
              <tr class="shopitem ${name}">
                <td class="name"><img src='./img/${img}'>
                  <br>${name}
                </td>
                <td>
                  <input class='price m-1' name='price' value=${price} readonly>
                  <input type="number" class='qty ${itemqty} m-1' name='qty' placeholder='0'>
                  <div class='text-end'>
                    <span>subtotal: </span><span class='subtotal'></span>
                  </div>
                </td>
                <td>
                  <input type="text" name="note" class="mb-2"><br>
                  <button class='cloneBtn btn btn-dark mx-1'><i class="fa-solid fa-clone fa-2xl" data-name='${name}'></i></i>
                  <button class='delBtn btn btn-dark'><i class="fa-solid fa-square-minus fa-2xl" data-name='${name}'></i></button>
                  </td>
              </tr>
              `;
          $("#orderHeader").after(html);
          // 用來取消click事件
          // $(this).off("click", order);
        }
        function countQty(itemqty) {
          let qty = 0;
          $("." + itemqty).each(function () {
            qty += parseInt($(this).val());
          });
          return qty;
        }
        function cloneBtn() {
          let cloneParent = $(this).closest("tr");
          console.log(cloneParent);
          cloneParent.clone(true).insertAfter(cloneParent);
          totalAmount();
        }
        //列出選單
        function itemToggle() {
          let item = $(this).data("item");
          $("#" + item).toggle();
        }
        //計算全部金額
        function totalAmount() {
          let allSubtotal = $(".subtotal");
          console.log(allSubtotal);
          let tmp = 0;
          allSubtotal.each(function (idx, val) {
            tmp += Number($(val).text());
          });
          if (tmp >= 500) {
            let dis = tmp - Math.ceil(tmp * 0.95);
            tmp = Math.ceil(tmp * 0.95);
            $("#orderTotal").text(tmp);
            $("#dis").text(dis);
            // console.log(tmp);
          } else {
            $("#orderTotal").text(tmp);
            $("#dis").text("0");
          }
        }
        function InOut(elm) {
          setInterval(function () {
            $(elm).fadeOut(300).fadeIn(700);
          }, 1000);
        }
        $(".itemBtn").on("click", itemToggle);
        //clone
        $("#orderHeader").parent().on("click", ".cloneBtn", cloneBtn);
        $(".orbtn").on("click", order);
        //刪除
        $("#orderHeader")
          .parent()
          .on("click", ".delBtn", (e) => {
            // console.log(e.target);
            let thisBtn = $(e.target).data("name");
            // console.log(e.target);
            //用來回復click事件
            // $("#" + thisBtn).on("click", order);
            e.target.closest("tr").remove();
            if($("."+thisBtn).length<=0){
            $("#" + thisBtn).removeClass("btn-light");
            $("#" + thisBtn).addClass("btn-outline-light");
          }
            totalAmount();
          });
        let orderParent = $("#orderHeader").parent();
        orderParent.on("change", ".qty", function (e) {
          let price = $(this).closest("tr").find(".price").val();
          let subtotal = Number($(this).val()) * Number(price);
          $(this).closest("tr").find(".subtotal").text(subtotal);
          totalAmount();
        });
        $("#calulate").on("click", function () {
          let coffeqty = countQty("coffeitem");
          let breadqty = countQty("breaditem");
          Swal.fire({
            confirmButtonColor: "#947055",
            title: "shopping cart",
            text:
              coffeqty + " cups of coffe || " + breadqty + " pieces of bread",
            showClass: {
              popup: `
        animate__animated
        animate__fadeInUp
        animate__faster
      `,
            },
          });
        });
        $("#ordernow").on("click", function () {
          if(parseInt($("#orderTotal").text())>0){
          Swal.fire({
            title: "check your order",
            text: "NTD" + $("#orderTotal").text(),
            icon: "info",
            showCancelButton: true,
            confirmButtonColor: "#947055",
            cancelButtonColor: "gray",
            confirmButtonText: "Yes, Confirmed!",
          }).then((result) => {
            if (result.isConfirmed) {
              let today = new Date();
              let lastNum = (
                "0000" + Math.ceil(Math.random() * 1000).toString()
              ).slice(-5);
              let orderDate =
                today.getFullYear().toString() +
                ("0" + (today.getMonth() + 1)).slice(-2) +
                ("0" + today.getDate()).slice(-2);
              orderNum = orderDate + lastNum;
              Swal.fire({
                title: "YOUR ORDER NO:" + orderNum,
                text: " NTD:" + $("#orderTotal").text(),
                confirmButtonColor: "#947055",
                icon: "success",
              });
              $(".shopitem").remove();
              countQty("coffeitem");
              countQty("breaditem");
              $(".endBtn").hide();
              $("#orderTotal").text(0);
              $("#dis").text(0);
              $(".orbtn").removeClass("btn-light", "btn-outline-light");
              $(".orbtn").addClass("btn-outline-light");
            }
          })
        }else{
          Swal.fire({
            icon:"warning",
            title:"Oh!",
            text:"looks like the cart is empty",
            confirmButtonColor:"gray"
          })
        }
        });
        $(".close").on("click", function () {
          $("#promation").remove();
        });
      });
    </script>
  </body>
</html>
